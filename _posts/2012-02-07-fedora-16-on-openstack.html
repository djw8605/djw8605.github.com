---
title: Fedora 16 on OpenStack
date: '2012-02-07T13:10:00.000-06:00'
author: Derek Weitzel
tags:
- osg
modified_time: '2012-02-07T13:10:18.602-06:00'
blogger_id: tag:blogger.com,1999:blog-3007054864987759910.post-1661685797417079292
blogger_orig_url: http://derekweitzel.blogspot.com/2012/02/fedora-16-on-openstack.html
---

After following Brian's guide on installing <a href="http://osgtech.blogspot.com/2011/08/creating-vm-for-openstack.html">Fedora 15 on OpenStack</a>, I thought I would try my hand at Fedora 16. &nbsp;There where a few differences.<br /><br /><span style="font-size: large;"><b>Filesystem Differences</b></span><br />Brian's guide installed Fedora using LVM. &nbsp;I installed Fedora without LVM (there's a little checkbox on the partition page of Anaconda). &nbsp;Without LVM, I can skip the steps on listing the physical volumes and logical volumes to find the start and end of the partition.<br /><br />Also, Fedora 16 uses gpt partition. &nbsp;fdisk command cannot read the partition table, therefore I had to install gdisk (in epel). &nbsp;Running it has very similar command and output:<br /><br /><pre>$ /usr/sbin/gdisk -l /tmp/fedora16<br />GPT fdisk (gdisk) version 0.8.1<br /><br />Partition table scan:<br />  MBR: protective<br />  BSD: not present<br />  APM: not present<br />  GPT: present<br /><br />Found valid GPT with protective MBR; using GPT.<br />Disk /tmp/fedora16: 20971520 sectors, 10.0 GiB<br />Logical sector size: 512 bytes<br />Disk identifier (GUID): A351197B-8233-4811-9B28-69A1DE121AD2<br />Partition table holds up to 128 entries<br />First usable sector is 34, last usable sector is 20971486<br />Partitions will be aligned on 2048-sector boundaries<br />Total free space is 4029 sectors (2.0 MiB)<br /><br />Number  Start (sector)    End (sector)  Size       Code  Name<br />   1            2048            4095   1024.0 KiB  EF02  <br />   2            4096         1028095   500.0 MiB   EF00  ext4<br />   3         1028096        16777215   7.5 GiB     0700  <br />   4        16777216        20969471   2.0 GiB     8200  <br /><br /></pre><br />Then, to extract the image:<br /><pre>dd if=/tmp/fedora16 of=/tmp/server-extract.img skip=1028096 count=$((16777215-1028096)) bs=512<br /></pre><br /><span style="font-size: large;"><b>SSH Key Differences</b></span><br />Brian's guide instructed you to create a /etc/rc.local. &nbsp;Fedora 16 sees the introduction of systemd, which no longer executes rc.local. &nbsp;Instead, it looks for the file /etc/rc.d/rc.local (possibly a symlink to /etc/rc.local?). &nbsp;This file needs to be executable and be sure to include the shebang.<br /><br />Also, Fedora 16's selinux doesn't label the root file system correctly (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=499343">BUG</a>), and simply making the .ssh directory doesn't not allow sshd to read it. &nbsp;To solve selinux problem, I disabled selinux (bad, bad me).<br /><br /><br /><span style="font-size: large;"><b>Common Commands</b></span><br />After installing Fedora 16 into an image, and extracting the kernel and ramdisk, there where a few commands that where executed over and over as I debugged the image:<br /><br />Make the changes to the image: <br /><pre>sudo /usr/libexec/qemu-kvm -m 2048 -drive file=/tmp/fedora16 -net nic -net user -vnc 127.0.0.1:0 -cpu qemu64 -M rhel5.6.0 -smp 2 -daemonize<br /></pre><br />Extract the partition: <br /><pre>dd if=/tmp/fedora16 of=/tmp/server-extract.img skip=1028096 count=$((16777215-1028096)) bs=512<br /></pre><br />Start the VM to change the label on the image:<br /><pre>sudo /usr/libexec/qemu-kvm -m 2048 -drive file=/tmp/fedora16 -net nic -net user -vnc 127.0.0.1:0 -cpu qemu64 -M rhel5.6.0 -smp 2 -daemonize -drive file=/tmp/server-extract.img <br /></pre><br />Rename the image to something appropriate:<br /><pre>mv /tmp/server-extract.img /tmp/fedora16-extracted.img<br /></pre><br />Bundle the image for OpenStack:<br /><pre>euca-bundle-image --kernel aki-0000002e --ramdisk ari-0000002f -i /tmp/fedora16-extracted.img -r x86_64<br /></pre><br />Upload the image to OpenStack:<br /><pre>euca-upload-bundle -b derek-bucket -m /tmp/fedora16-extracted.img.manifest.xm<br /></pre><br />Register the image (this command completes fast, but openstack takes for ever to decrypt and untar the image):<br /><pre>euca-register derek-bucket/fedora16-extracted.img.manifest.xml<br /></pre><br /><br />Now to build OSG packages for Fedora... &nbsp;maybe not.<br /><br /><br />
