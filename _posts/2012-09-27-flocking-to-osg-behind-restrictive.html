---
title: Flocking to the OSG behind a restrictive Firewall
date: '2012-09-27T22:28:00.001-05:00'
author: Derek Weitzel
tags:
- osg
- condor
modified_time: '2012-09-27T22:28:40.828-05:00'
blogger_id: tag:blogger.com,1999:blog-3007054864987759910.post-8114678098805193097
blogger_orig_url: http://derekweitzel.blogspot.com/2012/09/flocking-to-osg-behind-restrictive.html
---

On many campuses, restrictive firewalls are the name of the game, rather then the exception. &nbsp;Here at Nebraska, we have the ability to define our own network policies. &nbsp;But some universities / labs restrict firewall policies. &nbsp;In this post, I want to talk about how you can still flock to the OSG with only 1 port open to the external world.<br /><br />What you will need before beginning:<br /><ul><li>A RHEL 5 or 6 machine with root access.</li><li>The machine needs to have a public IP address, but does not need a lot of ports open. &nbsp;Actually only needs 1 port open. &nbsp;Make a note of what port is open.</li><li><b>An OSG Certificate:</b>&nbsp;I know that most people do not like using certificates. &nbsp;Actually, no one likes using certificates. &nbsp;Here is the newer, easier place you can apply for a new(ish) <a href="https://oim.grid.iu.edu/oim/certificate">digi-cert certificate</a>. &nbsp;Not sure if it's production yet.</li></ul><div><br /></div><div>First, we will start on the machine as root, we will install the OSG Repos. &nbsp;The instructions are on the <a href="https://twiki.grid.iu.edu/bin/view/Documentation/Release3/YumRepositories">OSG Twiki</a>. &nbsp;For RHEL 5, here's the short instructions:</div><div><pre class="rootscreen">$ rpm -Uvh http://dl.fedoraproject.org/pub/epel/5/i386/epel-release-5-4.noarch.rpm<br />$ yum install yum-priorities -y<br />$ rpm -Uvh http://repo.grid.iu.edu/osg-el5-release-latest.rpm</pre></div><br />Next we will send install Condor and the OSG-Condor-Flock packages on the machine. &nbsp;Documentation on setting up a Condor Flock is also on the <a href="https://twiki.grid.iu.edu/bin/view/CampusGrids/InstallCondorFlockSubmit">OSG Twiki</a>:<br /><pre>$ yum install condor osg-ca-certs -y<br />$ yum install --enablerepo=osg-development -y osg-condor-flock</pre><br />After installing these tools, we need to configure condor to use our certificate, and to flock to our glideinwms provider of choice.<br /><br />Next, we need to configure the host to use your certificate. &nbsp;In order to do this, we make your certificate the 'host' certificate. &nbsp;Copy your cert and key to: /etc/grid-security/hostcert.pem and /etc/grid-security/hostkey.pem.<br /><br />Next, we select the glideinwms provider of choice to use. &nbsp;This is covered more in-depth on the <a href="https://twiki.grid.iu.edu/bin/view/CampusGrids/InstallCondorFlockSubmit#Configuration_of_the_Submit_Mach">OSG Twiki</a>. &nbsp;You will also need to send your certificate to the OSG gateway provider you have chosen. &nbsp;Both have pages on the OSG OIM with contact information. &nbsp;<a href="mailto:engage-team@opensciencegrid.org">OSG Gateway</a>. &nbsp;<a href="http://hcc.unl.edu/contact/">HCC Gateway</a>.<br /><br />Next, we need to set condor to use only a single port, and specify that port. In&nbsp;/etc/condor/config.d/99_osg_flock.conf, add the following lines.<br /><pre>USE_SHARED_PORT = True<br />SHARED_PORT_ARGS = -p 4080<br /></pre><br />The port number (given by the argument after -p) can be any arbitrary port. &nbsp;Additionally, you will need to open the firewall. &nbsp;In iptables, add a line like:<br /><pre>-A RH-Firewall-1-INPUT -p tcp -m tcp --dport 4080 -j ACCEPT<br />-A RH-Firewall-1-INPUT -p udp -m udp --dport 4080 -j ACCEPT<br /></pre><br />And, that is all you need. &nbsp;Startup condor with 'service condor start', and you're on your way to running on the OSG with only 1 port open to the world.
