---
title: Moving from a Globus to an HTCondor Compute Element
date: '2014-02-27T17:05:00.001-06:00'
author: Derek Weitzel
tags:
- osg
- condor
modified_time: '2014-02-27T17:05:27.004-06:00'
thumbnail: http://4.bp.blogspot.com/-Cgs0xXtU0VU/Uw-7PMjMnRI/AAAAAAAACKo/xJ89GEg-JSc/s72-c/GlobusVSCondor.png
blogger_id: tag:blogger.com,1999:blog-3007054864987759910.post-7950648301232917905
blogger_orig_url: http://derekweitzel.blogspot.com/2014/02/moving-from-globus-to-htcondor-compute.html
---

<div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-Cgs0xXtU0VU/Uw-7PMjMnRI/AAAAAAAACKo/xJ89GEg-JSc/s1600/GlobusVSCondor.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-Cgs0xXtU0VU/Uw-7PMjMnRI/AAAAAAAACKo/xJ89GEg-JSc/s1600/GlobusVSCondor.png" height="63" width="320" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div>A few weeks ago, we moved our opportunistic clusters,&nbsp;<a href="https://hcc-docs.unl.edu/display/HCCDOC/Crane%2C+Tusker+and+Sandhills">Crane and Tusker</a>,&nbsp;from <a href="http://dev.globus.org/wiki/GRAM">Globus GRAM</a> gatekeepers to the new <a href="http://osgtech.blogspot.com/2013/01/introducing-htcondor-ce.html">HTCondor-CE</a>. &nbsp;We moved to the HTCondor-CE in order to solve performance issues we experienced with the GRAM when using the&nbsp;Slurm&nbsp;scheduler.<br /><br />When we switched Tusker from PBS to&nbsp;Slurm, we knew that we would have issues with the grid software.&nbsp;&nbsp;With PBS, Globus would use the scheduler event generator to efficiently watch for state changes in jobs, ie idle -&gt; running, running -&gt; completed.. &nbsp;But Globus does not have a scheduler event generator for Slurm, therefore it must query each job every few seconds in order to retrieve the current status. &nbsp;This caused a tremendous load on the scheduler, and on the machine.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-GH1ZkSWqZaI/Uw-4rBm2hSI/AAAAAAAACKc/n2P8yCaswrc/s1600/YearUsageGraph.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-GH1ZkSWqZaI/Uw-4rBm2hSI/AAAAAAAACKc/n2P8yCaswrc/s1600/YearUsageGraph.png" height="344" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Load graph on the gatekeeper</td></tr></tbody></table>We switched to the HTCondor-CE in order to alleviate some of this querying load. &nbsp;The HTCondor-CE provides configuration options to change how often it queries for job status, and can provide system wide throttles for job status querying.<br /><br />The HTCondor-CE also provides much better transparency to aid in administration. &nbsp;For example, there is no single command in Globus to view the status of the jobs. &nbsp;In the HTCondor-CE, there is, <span style="font-family: Courier New, Courier, monospace;">condor_ce_q</span>. &nbsp;This command will tell you exactly what jobs the CE is monitoring, and what it believes is their job status. &nbsp;Or if you want to know which jobs are currently transferring input files, they will have the <span style="font-family: Courier New, Courier, monospace;">&lt;</span>&nbsp;or <span style="font-family: Courier New, Courier, monospace;">&gt;</span>&nbsp;symbols for incoming or outgoing, respectively, in their job state column.<br /><br />The HTCondor-CE uses the same authentication and authorization methods as Globus. &nbsp;You still need a certificate, and you still need to be part of a VO. &nbsp;The job submission file looks a little different, instead of gt5 as your grid resource, it is condor:<br /><div class="gistLoad" data-id="9261269" id="gist-9261269">Loading ....</div><br /><h3>Improvements for the future</h3><div>The HTCondor-CE could be improved. &nbsp;For example, each real job has 2 entries in the <span style="font-family: Courier New, Courier, monospace;">condor_ce_q</span> output. &nbsp;This is due to the job routing from the incoming job to the scheduler specific job. &nbsp;The <span style="font-family: Courier New, Courier, monospace;">condor_ce_q</span> command could be improved to show linking between the 2 jobs, similar to the dag output of the <span style="font-family: Courier New, Courier, monospace;">condor_q</span> command.</div><div><br /></div><div>The job submission file is removed after a successful or unsuccessful submission to the local batch system (Slurm). &nbsp;This can make debugging very difficult if the job submission fails for any reason. &nbsp;Further, the gatekeeper doesn't propagate stdout / stderr of the submission command into the logs.</div><h3>Final Thoughts</h3><div>The initial impressions of the HTCondor-CE have been very good. &nbsp;Since installing the new CE, we have had ~100,000 production jobs run through the gatekeeper from many different users.<br /><br />And now for the obligatory accounting graphs:<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/--Zy3N1M9BKI/Uw_CxKkEd0I/AAAAAAAACLA/T7iM8bQlhpA/s1600/glidein_dn_hours_bar.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/--Zy3N1M9BKI/Uw_CxKkEd0I/AAAAAAAACLA/T7iM8bQlhpA/s1600/glidein_dn_hours_bar.png" height="400" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Usage of Tusker as reported by GlideinWMS probes.</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-cIMIhyJDmkw/Uw_EFHdblWI/AAAAAAAACLM/7cNjdmFLGxw/s1600/osg_vo_hours.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-cIMIhyJDmkw/Uw_EFHdblWI/AAAAAAAACLM/7cNjdmFLGxw/s1600/osg_vo_hours.png" height="400" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Wall Hours by VO on Tusker since the transition to the HTCondor-CE</td></tr></tbody></table><br /></div><div><br /></div><div><br /></div><script src="https://raw.github.com/moski/gist-Blogger/master/public/gistLoader.js" type="text/javascript"></script>
